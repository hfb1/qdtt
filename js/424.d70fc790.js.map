{"version":3,"file":"js/424.d70fc790.js","mappings":"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","sources":["webpack://htqdtt/./src/views/Home/index.vue","webpack://htqdtt/./src/views/Home/components/ArtileList.vue","webpack://htqdtt/src/views/Home/components/ArtileList.vue","webpack://htqdtt/./src/views/Home/components/ArtileList.vue?ff2c","webpack://htqdtt/./src/views/Home/components/ArtileList.vue?0c1f","webpack://htqdtt/./src/views/Home/ChannelEdit.vue","webpack://htqdtt/src/views/Home/ChannelEdit.vue","webpack://htqdtt/./src/views/Home/ChannelEdit.vue?7e18","webpack://htqdtt/./src/views/Home/ChannelEdit.vue?e870","webpack://htqdtt/src/views/Home/index.vue","webpack://htqdtt/./src/views/Home/index.vue?d35c","webpack://htqdtt/./src/views/Home/index.vue?4a09"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',[_c('div',[_c('van-nav-bar',{attrs:{\"fixed\":\"\"},scopedSlots:_vm._u([{key:\"left\",fn:function(){return [_c('img',{staticClass:\"logo\",attrs:{\"src\":require(\"@/assets/logo.png\"),\"alt\":\"\"}})]},proxy:true},{key:\"right\",fn:function(){return [_c('van-icon',{attrs:{\"name\":\"search\",\"size\":\"0.48rem\",\"color\":\"#fff\"},on:{\"click\":_vm.moveSearchPagesFn}})]},proxy:true}])})],1),_c('div',{staticClass:\"main\"},[_c('van-tabs',{attrs:{\"animated\":\"\",\"sticky\":\"\",\"offset-top\":\"1.226667rem\"},on:{\"change\":_vm.TabsChangeFn},model:{value:(_vm.channelId),callback:function ($$v) {_vm.channelId=$$v},expression:\"channelId\"}},_vm._l((_vm.userChannelList),function(obj){return _c('van-tab',{key:obj.id,attrs:{\"title\":obj.name,\"name\":obj.id}},[_c('ArticleList',{attrs:{\"channelId\":_vm.channelId}})],1)}),1),_c('van-icon',{staticClass:\"moreChannels\",attrs:{\"name\":\"plus\",\"size\":\"0.37333334rem\"},on:{\"click\":_vm.plusClickFn}})],1),_c('van-popup',{staticClass:\"channel_popup\",attrs:{\"get-container\":\"body\"},model:{value:(_vm.show),callback:function ($$v) {_vm.show=$$v},expression:\"show\"}},[_c('ChannelEdit',{ref:\"editRef\",attrs:{\"userList\":_vm.userChannelList,\"unCheckList\":_vm.unChannelList},on:{\"addChannelEV\":_vm.addChannelFn,\"removeChannelEV\":_vm.removeChannelFn,\"closeEv\":_vm.closeFn,\"changeChannelEV\":_vm.changeChannelFn}})],1)],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',[_c('van-pull-refresh',{on:{\"refresh\":_vm.onRefresh},model:{value:(_vm.isLoading),callback:function ($$v) {_vm.isLoading=$$v},expression:\"isLoading\"}},[_c('van-list',{attrs:{\"finished\":_vm.finished,\"finished-text\":\"没有更多了\",\"immediate-check\":false,\"offset\":\"50\"},on:{\"load\":_vm.onLoad},model:{value:(_vm.loading),callback:function ($$v) {_vm.loading=$$v},expression:\"loading\"}},_vm._l((_vm.list),function(obj){return _c('ArtileItem',{key:obj.art_id,attrs:{\"artObj\":obj},on:{\"disLikeEV\":_vm.disLikeFn,\"reportsEV\":_vm.reportsFn},nativeOn:{\"click\":function($event){return _vm.itemClickFn(obj.art_id)}}})}),1)],1)],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div>\r\n    <van-pull-refresh v-model=\"isLoading\" @refresh=\"onRefresh\">\r\n      <van-list\r\n        v-model=\"loading\"\r\n        :finished=\"finished\"\r\n        finished-text=\"没有更多了\"\r\n        @load=\"onLoad\"\r\n        :immediate-check=\"false\"\r\n        offset=\"50\"\r\n      >\r\n        <!-- 文章列表 -->\r\n        <ArtileItem\r\n          v-for=\"obj in list\"\r\n          :key=\"obj.art_id\"\r\n          :artObj=\"obj\"\r\n          @disLikeEV=\"disLikeFn\"\r\n          @reportsEV=\"reportsFn\"\r\n          @click.native=\"itemClickFn(obj.art_id)\"\r\n        ></ArtileItem>\r\n      </van-list>\r\n    </van-pull-refresh>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { getAllArticleListsAPI, articleDislikeAPI, articleReportsAPI } from '@/api'\r\nimport ArtileItem from '../../../components/ArtileItem.vue'\r\nimport Notify from '@/ui/Notify.js'\r\n// 问题1：网页刚打开，created请求和onload请求同时发送，请求的都是最新数据\r\n// onload中，2次一样的数据合并，数据重复，key重复了\r\n// 原因：van-list组件，组件挂载时，默认就会判定一次是否触底\r\nexport default {\r\n  props: {\r\n    channelId: Number// 频道ID\r\n  },\r\n  data () {\r\n    return {\r\n      list: [], // 文章列表数组\r\n      loading: false, // 底部加载状态\r\n      finished: false, // 底部完成状态\r\n      theTime: (new Date()).getTime(), // 用于分页的时间戳\r\n      isLoading: false// 顶部的加载状态\r\n    }\r\n  },\r\n  components: {\r\n    ArtileItem\r\n  },\r\n  async created () {\r\n    // pre_timestamp\r\n    // 下一段开头的那一篇的文章的时间戳\r\n    // 第一次 系统时间（timestamp）->后台 返回0-9条数据 ->携带第10条 pre_timestamp值返回\r\n    // 第二次 （timestamp）-上一次 pre_timestamp（代表告诉后台，从指定的时间戳再找10条）\r\n    this.getArticleListFn()\r\n  },\r\n  methods: {\r\n    // 获取文章列表\r\n    async getArticleListFn () {\r\n      const { data: res } = await getAllArticleListsAPI({\r\n        channel_id: this.channelId, // 频道id\r\n        timestamp: this.theTime// 时间戳\r\n      })\r\n      console.log('获取文章列表', res)\r\n\r\n      // created()上来第一次list是空数组，合并空数组没问题\r\n      // onload触底加载更多，2个数组合并更没问题\r\n      this.list = [...this.list, ...res.data.results]\r\n      this.theTime = res.data.pre_timestamp\r\n\r\n      this.loading = false// 如果不关闭，底部一直是加载中状态，下次触底会再触发onload\r\n      if (res.data.pre_timestamp === null) { // 本次回来的数据是最后的，没有下一段数据了\r\n        this.finished = true\r\n      }\r\n      // 顶部的加载状态改为false\r\n      this.isLoading = false\r\n    },\r\n    // 底部加载的事件方法\r\n    async onLoad () {\r\n      // immediate-check:内部不要进行判断而已，监听滚动事件的代码还在\r\n      // 第一个频道滚动到底部，再切换到第二个频道的时候（新建-内容没有那么高），滚动会从底部滚动到顶部\r\n      // 这个时候发生了滚动，所以滚动事件还是触发了，immediate-check判断无效\r\n      if (this.list.length === 0) {\r\n        this.loading = false\r\n        return // 如果页面没有数据，没有高度，让本次onload逻辑代码不往下执行\r\n      }\r\n      // console.log(123)\r\n      // 当触底的时候\r\n      this.getArticleListFn()\r\n    },\r\n    // 下拉刷新--刷新数据事件方法\r\n    async onRefresh () {\r\n      // 目标：list数组清空，来一份新的数据\r\n      this.list = []\r\n      this.theTime = (new Date()).getTime()\r\n      // 发送网络请求\r\n      this.getArticleListFn()\r\n    },\r\n    // 反馈--不感兴趣\r\n    async disLikeFn (id) {\r\n      // 如果用try catch自己处理错误，内部throw就不会向控制台抛出打印错误，而是交给你的try catch来自定义错误处理\r\n      // try捕获同步代码的异常\r\n      try {\r\n        await articleDislikeAPI({\r\n          artId: id\r\n        })\r\n        Notify({ type: 'success', message: '反馈成功' })\r\n      } catch (error) {\r\n        Notify({ type: 'warning', message: '举报失败' })\r\n      }\r\n    },\r\n    // 反馈--举报\r\n    async reportsFn (id, value) {\r\n      try {\r\n        await articleReportsAPI({\r\n          artId: id,\r\n          type: value,\r\n          remark: '就是其他问题'\r\n        })\r\n        Notify({ type: 'success', message: '举报成功' })\r\n      } catch (error) {\r\n        Notify({ type: 'warning', message: '举报失败' })\r\n      }\r\n    },\r\n    // 文章单元格-点击事件\r\n    itemClickFn (id) {\r\n      this.$router.push({\r\n        path: `/detail?art_id=${id}`\r\n      })\r\n    }\r\n  }\r\n}\r\n</script>\r\n","import mod from \"-!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./ArtileList.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./ArtileList.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./ArtileList.vue?vue&type=template&id=ecf41786&\"\nimport script from \"./ArtileList.vue?vue&type=script&lang=js&\"\nexport * from \"./ArtileList.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',[_c('van-nav-bar',{attrs:{\"title\":\"频道管理\"},scopedSlots:_vm._u([{key:\"right\",fn:function(){return [_c('van-icon',{attrs:{\"name\":\"cross\",\"size\":\"0.37333334rem\",\"color\":\"white\"},on:{\"click\":_vm.closeFn}})]},proxy:true}])}),_c('div',{staticClass:\"my-channel-box\"},[_c('div',{staticClass:\"channel-title\"},[_c('span',[_vm._v(\" 我的频道 \"),_c('span',{staticClass:\"small-title\"},[_vm._v(\" 点击\"+_vm._s(_vm.isEdit ? \"删除\" : \"进入\")+\"频道 \")])]),_c('span',{on:{\"click\":_vm.editFn}},[_vm._v(_vm._s(_vm.isEdit ? \"完成\" : \"编辑\"))])]),_c('van-row',{attrs:{\"type\":\"flex\"}},_vm._l((_vm.userList),function(obj){return _c('van-col',{key:obj.id,attrs:{\"span\":\"6\"},on:{\"click\":function($event){return _vm.userChannelFn(obj)}}},[_c('div',{staticClass:\"channel-item van-hairline--surround\"},[_vm._v(\" \"+_vm._s(obj.name)+\" \"),_c('van-badge',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.isEdit && obj.id),expression:\"isEdit && obj.id\"}],staticClass:\"cross-badge\",attrs:{\"color\":\"transparent\"},scopedSlots:_vm._u([{key:\"content\",fn:function(){return [_c('van-icon',{staticClass:\"badge-icon\",attrs:{\"name\":\"cross\",\"color\":\"#cfcfcf\",\"size\":\"0.32rem\"}})]},proxy:true}],null,true)})],1)])}),1)],1),_c('div',{staticClass:\"more-channel-box\"},[_vm._m(0),_c('van-row',{attrs:{\"type\":\"flex\"}},_vm._l((_vm.unCheckList),function(obj){return _c('van-col',{key:obj.id,attrs:{\"span\":\"6\"},on:{\"click\":function($event){return _vm.moreFn(obj)}}},[_c('div',{staticClass:\"channel-item van-hairline--surround\"},[_vm._v(_vm._s(obj.name))])])}),1)],1)],1)\n}\nvar staticRenderFns = [function (){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"channel-title\"},[_c('span',[_vm._v(\"点击添加更多频道：\")])])\n}]\n\nexport { render, staticRenderFns }","<template>\r\n  <div>\r\n    <!-- 弹出层的头部区域 -->\r\n    <van-nav-bar title=\"频道管理\">\r\n      <template #right>\r\n        <van-icon\r\n          name=\"cross\"\r\n          size=\"0.37333334rem\"\r\n          color=\"white\"\r\n          @click=\"closeFn\"\r\n        />\r\n      </template>\r\n    </van-nav-bar>\r\n    <!-- 我的频道 -->\r\n    <div class=\"my-channel-box\">\r\n      <div class=\"channel-title\">\r\n        <span>\r\n          我的频道\r\n          <span class=\"small-title\">\r\n            点击{{ isEdit ? \"删除\" : \"进入\" }}频道\r\n          </span>\r\n        </span>\r\n        <span @click=\"editFn\">{{ isEdit ? \"完成\" : \"编辑\" }}</span>\r\n      </div>\r\n      <!-- 我的频道列表 -->\r\n      <van-row type=\"flex\">\r\n        <van-col\r\n          span=\"6\"\r\n          v-for=\"obj in userList\"\r\n          :key=\"obj.id\"\r\n          @click=\"userChannelFn(obj)\"\r\n        >\r\n          <div class=\"channel-item van-hairline--surround\">\r\n            {{ obj.name }}\r\n            <!-- 删除的徽标 -->\r\n            <van-badge\r\n              color=\"transparent\"\r\n              class=\"cross-badge\"\r\n              v-show=\"isEdit && obj.id\"\r\n            >\r\n              <template #content>\r\n                <van-icon\r\n                  name=\"cross\"\r\n                  class=\"badge-icon\"\r\n                  color=\"#cfcfcf\"\r\n                  size=\"0.32rem\"\r\n                />\r\n              </template>\r\n            </van-badge>\r\n          </div>\r\n        </van-col>\r\n      </van-row>\r\n    </div>\r\n\r\n    <!-- 更多频道 -->\r\n    <div class=\"more-channel-box\">\r\n      <div class=\"channel-title\">\r\n        <span>点击添加更多频道：</span>\r\n      </div>\r\n      <!-- 更多频道列表 -->\r\n      <van-row type=\"flex\">\r\n        <van-col\r\n          span=\"6\"\r\n          v-for=\"obj in unCheckList\"\r\n          :key=\"obj.id\"\r\n          @click=\"moreFn(obj)\"\r\n        >\r\n          <div class=\"channel-item van-hairline--surround\">{{ obj.name }}</div>\r\n        </van-col>\r\n      </van-row>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data () {\r\n    return {\r\n      isEdit: false// 编辑频道上的编辑状态（x）\r\n    }\r\n  },\r\n  props: {\r\n    userList: Array, // 用户已选\r\n    unCheckList: Array // 用户未选\r\n  },\r\n  methods: {\r\n    // 编辑--点击事件\r\n    editFn () {\r\n      this.isEdit = !this.isEdit\r\n    },\r\n    // 更多频道--点击事件\r\n    moreFn (channelObj) {\r\n      if (this.isEdit === true) { // 处于编辑状态\r\n        this.$emit('addChannelEV', channelObj)\r\n      }\r\n    },\r\n    // 用户选择频道--点击事件\r\n    userChannelFn (channelObj) {\r\n      if (this.isEdit === true) { // 删除频道\r\n        if (channelObj.id !== 0) {\r\n          this.$emit('removeChannelEV', channelObj)\r\n        }\r\n      } else { // 切换频道\r\n        this.$emit('changeChannelEV', channelObj)\r\n      }\r\n    },\r\n    // 关闭弹出层的方法\r\n    closeFn () {\r\n      this.$emit('closeEv', this.isEdit)\r\n      // 让内部的编辑状态回归false\r\n      // this.isEdit = false\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n.van-popup,\r\n.popup-container {\r\n  background-color: transparent;\r\n  height: 100%;\r\n  width: 100%;\r\n}\r\n\r\n.popup-container {\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n.pop-header {\r\n  height: 90px;\r\n  background-color: #007bff;\r\n  color: white;\r\n  text-align: center;\r\n  font-size: 14px;\r\n  position: relative;\r\n  .title {\r\n    width: 100%;\r\n    position: absolute;\r\n    bottom: 15px;\r\n  }\r\n}\r\n\r\n.pop-body {\r\n  flex: 1;\r\n  overflow: scroll;\r\n  padding: 8px;\r\n  background-color: white;\r\n}\r\n\r\n.my-channel-box,\r\n.more-channel-box {\r\n  .channel-title {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    font-size: 14px;\r\n    line-height: 28px;\r\n    padding: 0 6px;\r\n  }\r\n}\r\n\r\n.channel-item {\r\n  font-size: 12px;\r\n  text-align: center;\r\n  line-height: 36px;\r\n  background-color: #fafafa;\r\n  margin: 5px;\r\n}\r\n\r\n/*删除的微标 */\r\n.cross-badge {\r\n  position: absolute;\r\n  right: -3px;\r\n  top: 0;\r\n  border: none;\r\n}\r\n\r\n/*提示文字 */\r\n.small-title {\r\n  font-size: 10px;\r\n  color: gray;\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./ChannelEdit.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./ChannelEdit.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./ChannelEdit.vue?vue&type=template&id=2c5a8060&scoped=true&\"\nimport script from \"./ChannelEdit.vue?vue&type=script&lang=js&\"\nexport * from \"./ChannelEdit.vue?vue&type=script&lang=js&\"\nimport style0 from \"./ChannelEdit.vue?vue&type=style&index=0&id=2c5a8060&prod&scoped=true&lang=less&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"2c5a8060\",\n  null\n  \n)\n\nexport default component.exports","<template>\r\n  <div>\r\n    <!-- 头部导航 -->\r\n    <div>\r\n      <van-nav-bar fixed>\r\n        <template v-slot:left>\r\n          <img src=\"@/assets/logo.png\" alt=\"\" class=\"logo\" />\r\n        </template>\r\n        <template v-slot:right>\r\n          <!-- 坑：postcss只能翻译style里css样式代码\r\n                标签内行样式样式它无法px转rem\r\n                所以需要自己手动计算\r\n           -->\r\n          <van-icon\r\n            name=\"search\"\r\n            size=\"0.48rem\"\r\n            color=\"#fff\"\r\n            @click=\"moveSearchPagesFn\"\r\n          />\r\n        </template>\r\n      </van-nav-bar>\r\n    </div>\r\n    <!--tab栏导航\r\n        van-tabs：一行容器\r\n        van-tab：每个tab栏\r\n        v-model：关联的激活项的下标（双向绑定）\r\n        v-model为什么能在组件上使用？\r\n      重要：每个van-tab代表一个标签导航，中间夹着内容，对应的下属列表内容\r\n      重要：每个van-tab都对应着独立的自己的ArticleList（多次）\r\n      细节：van-tab循环了很多标签导航，与之一一对应的内容列表不是上来创建的，默认创建当前激活导航对应的列表组件\r\n          第一次切换到对应频道时，才会创建下属的组件->created方法；\r\n          第二次切换就是显示/隐藏切换\r\n    -->\r\n    <!-- 解决：外面现在使用的是同一个数组切换数据（多个ArticleList用的是同一个数组，换会影响别人）\r\n          文章列表数据，请求，数组，分别放入ArticleList内部（自己请求自己的数据）\r\n          外边只负责传入当前激活的频道ID\r\n\r\n     -->\r\n    <div class=\"main\">\r\n      <van-tabs\r\n        v-model=\"channelId\"\r\n        @change=\"TabsChangeFn\"\r\n        animated\r\n        sticky\r\n        offset-top=\"1.226667rem\"\r\n      >\r\n        <van-tab\r\n          :title=\"obj.name\"\r\n          v-for=\"obj in userChannelList\"\r\n          :key=\"obj.id\"\r\n          :name=\"obj.id\"\r\n        >\r\n          <ArticleList :channelId=\"channelId\"> </ArticleList>\r\n        </van-tab>\r\n      </van-tabs>\r\n      <!-- 编辑频道图标 -->\r\n      <van-icon\r\n        name=\"plus\"\r\n        size=\"0.37333334rem\"\r\n        class=\"moreChannels\"\r\n        @click=\"plusClickFn\"\r\n      />\r\n    </div>\r\n    <!-- 频道管理的弹出层 -->\r\n    <van-popup class=\"channel_popup\" v-model=\"show\" get-container=\"body\">\r\n      <ChannelEdit\r\n        :userList=\"userChannelList\"\r\n        :unCheckList=\"unChannelList\"\r\n        @addChannelEV=\"addChannelFn\"\r\n        @removeChannelEV=\"removeChannelFn\"\r\n        @closeEv=\"closeFn\"\r\n        @changeChannelEV=\"changeChannelFn\"\r\n        ref=\"editRef\"\r\n      ></ChannelEdit>\r\n    </van-popup>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { getUserChannelsAPI, getAllChannelsAPI, updateChannelsAPI, removeChannelAPI } from '@/api'\r\nimport ArticleList from './components/ArtileList.vue'\r\nimport ChannelEdit from './ChannelEdit.vue'\r\nexport default {\r\n  name: 'Home',\r\n  data () {\r\n    return {\r\n      channelId: 0, // tab导航栏-激活频道ID(默认频道ID为0，页面刚打开是推荐频道高亮-对应文章数据)\r\n      userChannelList: [], // 用户选择的频道列表\r\n      allChannelList: [], // 所有频道列表\r\n      show: false, // 弹出层显示/隐藏\r\n      channelScrollTObj: {}// 保存每个频道的滚动位置\r\n      // 值样子构想：{推荐频道ID：对应滚动距离，html频道ID：自己滚动距离}\r\n    }\r\n  },\r\n  methods: {\r\n    // tabs栏切换-频道切换\r\n    TabsChangeFn () {\r\n      this.$nextTick(() => {\r\n        // tab切换后，设置滚动条的位置\r\n        document.documentElement.scrollTop = this.channelScrollTObj[this.channelId]\r\n      })\r\n    },\r\n    // 获取用户的频道列表\r\n    async getChannels () {\r\n      const { data: res } = await getUserChannelsAPI()\r\n      console.log('用户频道：', res)\r\n      this.userChannelList = res.data.channels\r\n    },\r\n    // 点击显示频道页面\r\n    plusClickFn () {\r\n      this.show = true\r\n    },\r\n    // 获取到所有的频道列表\r\n    async getAllChannels () {\r\n      const { data: res } = await getAllChannelsAPI()\r\n      this.allChannelList = res.data.channels\r\n    },\r\n    // 添加频道\r\n    async addChannelFn (channelObj) {\r\n      this.userChannelList.push(channelObj)\r\n      // 还要把最新的数组发给后台\r\n\r\n      // 数组里的对象字段->转换\r\n      // 推荐频道不能传递--筛选出不是推荐频道剩下的频道对象\r\n      const newArr = this.userChannelList.filter(obj => obj.id !== 0)\r\n      const theNewArr = newArr.map((obj, index) => {\r\n        const newObj = { ...obj }// 浅拷贝\r\n        delete newObj.name\r\n        newObj.seq = index\r\n\r\n        return newObj// 让map方法把新对象收集起来形成一个新数组\r\n      })\r\n\r\n      const res = await updateChannelsAPI({\r\n        channels: theNewArr\r\n      })\r\n      console.log('更新用户频道：', res)\r\n    },\r\n    // 删除频道\r\n    async removeChannelFn (channelObj) {\r\n      const index = this.userChannelList.findIndex((obj) => obj.id === channelObj.id)\r\n      this.userChannelList.splice(index, 1)\r\n\r\n      // 第一种方法：把现在用户数组的数据，覆盖式发给后台\r\n      // 需要把上面的更新数组过程，封装一个函数，add和remove里调用（笔记里）\r\n      // 第二种方法:只调用删除的接口\r\n      const res = await removeChannelAPI({\r\n        channelId: channelObj.id\r\n      })\r\n      console.log('删除选择频道的返回：', res)\r\n    },\r\n    // 关闭弹出层\r\n    closeFn () {\r\n      this.show = false\r\n      this.$refs.editRef.isEdit = false\r\n    },\r\n    // 弹出层里--切换频道\r\n    changeChannelFn (channelObj) {\r\n      this.show = false\r\n      this.channelId = channelObj.id\r\n    },\r\n    // 首页-左上角放大镜点击事件- 跳转搜索页面\r\n    moveSearchPagesFn () {\r\n      this.$router.push('/search')\r\n    },\r\n    // 监听网页的滚动--事件\r\n    scrollFn () {\r\n      // html的滚动距离：document.documentElement.scrollTop\r\n      this.$route.meta.scrollT = document.documentElement.scrollTop\r\n      // 同时保存当前频道的滚动距离\r\n      this.channelScrollTObj[this.channelId] = document.documentElement.scrollTop\r\n      // console.log(this.channelScrollTObj)\r\n    }\r\n\r\n    // 新增时，名字被删除了\r\n    // 原因：所有数组里的对象。都是同一个内存地址，影响到ChannelEdit.vue中对象\r\n    // 解决方案：\r\n  },\r\n  // 计算属性\r\n  computed: {\r\n\r\n    unChannelList () {\r\n      // 目标：把所有的频道数组挨个对象取出，去用户已选的频道数组查找，如果找不到，则让filter方法收集到一个新数组里\r\n      const newArr = this.allChannelList.filter((bigObj) => {\r\n        // 找相等的下标找到，不符合条件返回-1\r\n        const index = this.userChannelList.findIndex(smallObj => {\r\n          return smallObj.id === bigObj.id\r\n        })\r\n        // 如果找到了\r\n        if (index > -1) {\r\n          return false\r\n        } else {\r\n          return true\r\n        }\r\n      })\r\n      return newArr\r\n    }\r\n  },\r\n  created () {\r\n    // 获取频道列表\r\n    this.getChannels()\r\n    this.getAllChannels()\r\n  },\r\n  // 组件失活\r\n  // // 前提：组件缓存，切走了就是失去激活生命周期方法触发\r\n  // //      无组件缓存，被切走了，走destroyed销毁生命周期方法\r\n  // // 每个页面都有自己独立的路由规则对象\r\n  // // 先切走再执行的\r\n  // deactivated () {\r\n  //   this.$route.meta.scrollT = document.documentElement.scrollTop\r\n  // },\r\n\r\n  // 组件激活\r\n  activated () {\r\n    console.log(this.$route)\r\n    // 实时监控\r\n    window.addEventListener('scroll', this.scrollFn)\r\n    // window和document，监听网页滚动的事件\r\n    // html标签获取scrollTop，滚动的距离，和设置滚动的位置\r\n    // 立刻设置，滚动条的位置\r\n    document.documentElement.scrollTop = this.$route.meta.scrollT\r\n  },\r\n  // 失活-销毁\r\n  deactivated () {\r\n    window.removeEventListener('scroll', this.scrollFn)\r\n  },\r\n  components: {\r\n    ArticleList, ChannelEdit\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.logo {\r\n  width: 100px;\r\n  height: 30px;\r\n}\r\n.main {\r\n  padding-top: 46px;\r\n}\r\n// 设置 tabs 容器的样式\r\n/deep/ .van-tabs__wrap {\r\n  padding-right: 30px;\r\n  background-color: #fff;\r\n}\r\n\r\n// 设置小图标的样式\r\n.moreChannels {\r\n  position: fixed;\r\n  top: 62px;\r\n  right: 8px;\r\n  z-index: 999;\r\n}\r\n.channel_popup {\r\n  width: 100vw;\r\n  height: 100vh;\r\n}\r\n// 如果想给100%，要先给html和body设置100%\r\n// vh和vw是css3新出的单位，参考的是浏览器窗口的百分比\r\n</style>\r\n","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=f7286478&scoped=true&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=f7286478&prod&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"f7286478\",\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","attrs","scopedSlots","_u","key","fn","staticClass","require","proxy","on","moveSearchPagesFn","TabsChangeFn","model","value","channelId","callback","$$v","expression","_l","userChannelList","obj","id","name","plusClickFn","show","ref","unChannelList","addChannelFn","removeChannelFn","closeFn","changeChannelFn","staticRenderFns","onRefresh","isLoading","finished","onLoad","loading","list","art_id","disLikeFn","reportsFn","nativeOn","$event","itemClickFn","props","data","theTime","components","ArtileItem","methods","channel_id","timestamp","console","artId","Notify","type","message","remark","path","component","_v","_s","isEdit","editFn","userList","userChannelFn","directives","rawName","_m","unCheckList","moreFn","allChannelList","channelScrollTObj","document","newObj","channels","scrollFn","computed","created","activated","window","deactivated","ArticleList","ChannelEdit"],"sourceRoot":""}